groups:
  - name: myapp.rules
    rules:

      # ── Availability ──────────────────────────────────────────────────────────
      - alert: ServiceDown
        expr: up{job="myapp"} == 0
        for: 1m
        labels:
          severity: critical
          service: myapp
        annotations:
          summary: "Service myapp is down"
          description: "myapp has been unreachable for more than 1 minute."

      # ── Error Rate ────────────────────────────────────────────────────────────
      - alert: HighErrorRate
        expr: |
          sum(rate(http_requests_total{job="myapp",status=~"5.."}[5m]))
          /
          sum(rate(http_requests_total{job="myapp"}[5m])) > 0.05
        for: 5m
        labels:
          severity: warning
          service: myapp
        annotations:
          summary: "High error rate on myapp"
          description: "Error rate is above 5% for the last 5 minutes (current: {{ $value | humanizePercentage }})."

      # ── Latency ───────────────────────────────────────────────────────────────
      - alert: HighLatency
        expr: |
          histogram_quantile(0.99,
            sum(rate(http_request_duration_seconds_bucket{job="myapp"}[5m])) by (le)
          ) > 2
        for: 5m
        labels:
          severity: warning
          service: myapp
        annotations:
          summary: "High p99 latency on myapp"
          description: "p99 latency is above 2s for the last 5 minutes (current: {{ $value | humanizeDuration }})."

      # ── Memory ────────────────────────────────────────────────────────────────
      - alert: HighMemoryUsage
        expr: |
          process_resident_memory_bytes{job="myapp"} > 500 * 1024 * 1024
        for: 10m
        labels:
          severity: warning
          service: myapp
        annotations:
          summary: "High memory usage on myapp"
          description: "Memory usage is above 500MB for 10 minutes (current: {{ $value | humanize1024 }}B)."

      # ── Restarts ──────────────────────────────────────────────────────────────
      - alert: FrequentRestarts
        expr: |
          increase(kube_pod_container_status_restarts_total{container="myapp"}[1h]) > 5
        for: 0m
        labels:
          severity: warning
          service: myapp
        annotations:
          summary: "myapp pod restarting frequently"
          description: "Pod has restarted more than 5 times in the last hour."
