apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ "{{" }} .Release.Name {{ "}}" }}-{{.AppName}}
  labels:
    app: {{.AppName}}
    chart: {{ "{{" }} .Chart.Name {{ "}}" }}-{{ "{{" }} .Chart.Version {{ "}}" }}
    release: {{ "{{" }} .Release.Name {{ "}}" }}
spec:
  replicas: {{ "{{" }} .Values.replicaCount {{ "}}" }}
  selector:
    matchLabels:
      app: {{.AppName}}
      release: {{ "{{" }} .Release.Name {{ "}}" }}
  template:
    metadata:
      labels:
        app: {{.AppName}}
        release: {{ "{{" }} .Release.Name {{ "}}" }}
    spec:
      containers:
        - name: {{.AppName}}
          image: "{{ "{{" }} .Values.image.repository {{ "}}" }}:{{ "{{" }} .Values.image.tag {{ "}}" }}"
          imagePullPolicy: {{ "{{" }} .Values.image.pullPolicy {{ "}}" }}
          ports:
            - name: http
              containerPort: {{ "{{" }} .Values.service.targetPort {{ "}}" }}
              protocol: TCP
          livenessProbe:
            httpGet:
              path: {{ "{{" }} .Values.livenessProbe.httpGet.path {{ "}}" }}
              port: {{ "{{" }} .Values.livenessProbe.httpGet.port {{ "}}" }}
            initialDelaySeconds: {{ "{{" }} .Values.livenessProbe.initialDelaySeconds {{ "}}" }}
            periodSeconds: {{ "{{" }} .Values.livenessProbe.periodSeconds {{ "}}" }}
          readinessProbe:
            httpGet:
              path: {{ "{{" }} .Values.readinessProbe.httpGet.path {{ "}}" }}
              port: {{ "{{" }} .Values.readinessProbe.httpGet.port {{ "}}" }}
            initialDelaySeconds: {{ "{{" }} .Values.readinessProbe.initialDelaySeconds {{ "}}" }}
            periodSeconds: {{ "{{" }} .Values.readinessProbe.periodSeconds {{ "}}" }}
          resources:
            requests:
              cpu: {{ "{{" }} .Values.resources.requests.cpu {{ "}}" }}
              memory: {{ "{{" }} .Values.resources.requests.memory {{ "}}" }}
            limits:
              cpu: {{ "{{" }} .Values.resources.limits.cpu {{ "}}" }}
              memory: {{ "{{" }} .Values.resources.limits.memory {{ "}}" }}
          envFrom:
            - configMapRef:
                name: {{ "{{" }} .Release.Name {{ "}}" }}-{{.AppName}}-config
